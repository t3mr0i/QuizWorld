<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quizaru - Interactive Quiz Game</title>
    <meta name="description" content="Create and play interactive quizzes with AI-generated questions">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;900&family=Roboto+Mono:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- Phosphor Icons -->
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/@phosphor-icons/web@2.1.1/src/regular/style.css" />
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/@phosphor-icons/web@2.1.1/src/fill/style.css" />
    <link rel="stylesheet" href="css/styles.css">
    <!-- Add favicon -->
    <link rel="icon" type="image/svg+xml" href="img/icons/favicon.svg">
    <!-- PartyKit Configuration -->
    <script>
        // Hard-code the PartyKit host to avoid placeholder issues
        window.PARTYKIT_HOST = 'quiz-world.t3mr0i.partykit.dev';
        
        // Enable dev mode to try local server if URL has ?dev parameter or running on localhost
        const urlParams = new URLSearchParams(window.location.search);
        const isLocalhost = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
        
        if (urlParams.has('dev') || urlParams.has('local') || isLocalhost) {
            window.PARTYKIT_HOST = 'localhost:1999';
            console.log('Using local development server:', window.PARTYKIT_HOST);
        }
        
        // Add a config flag to disable host-only restriction
        window.CONFIG = {
            ALLOW_ANYONE_TO_START: urlParams.has('allow-all') || urlParams.has('all-start')
        };
        
        // Log the configuration
        console.log('Game configuration:', window.CONFIG);
        
        // Add a visible banner when in local development mode
        if (urlParams.has('local') || urlParams.has('dev') || isLocalhost) {
            document.addEventListener('DOMContentLoaded', function() {
                const debugBanner = document.createElement('div');
                debugBanner.className = 'debug-banner';
                debugBanner.innerHTML = 'LOCAL DEV MODE';
                debugBanner.style.position = 'fixed';
                debugBanner.style.top = '0';
                debugBanner.style.left = '0';
                debugBanner.style.right = '0';
                debugBanner.style.backgroundColor = 'red';
                debugBanner.style.color = 'white';
                debugBanner.style.textAlign = 'center';
                debugBanner.style.padding = '4px';
                debugBanner.style.zIndex = '9999';
                debugBanner.style.fontSize = '12px';
                debugBanner.style.fontWeight = 'bold';
                document.body.appendChild(debugBanner);
            });
        }
    </script>
</head>
<body>
    <div class="app-container">
        <!-- Navigation and header -->
        <div class="navbar fixed-top">
            <div class="container d-flex justify-content-between align-items-center">
                <a href="#" class="navbar-brand">
                    <h1 class="mb-0"><i class="ph ph-brain"></i> QuizWorld</h1>
                </a>
            </div>
        </div>

        <main class="game-container">
            <!-- Welcome Screen -->
            <div id="welcome-screen" class="game-screen active">
                <div class="card welcome-card">
                    <div class="card-header">
                        <h2>Welcome to QuizWorld</h2>
                        <p>Create AI-powered quizzes or join existing games</p>
                    </div>
                    <div class="card-body">
                        <div class="welcome-options">
                            <div class="option-card" id="create-quiz-option">
                                <div class="option-icon"><i class="ph ph-target"></i></div>
                                <h3>Create New Quiz</h3>
                                <p>Generate a quiz with AI on any topic</p>
                                <button class="btn btn-primary">Create Quiz</button>
                            </div>
                            
                            <div class="option-card" id="create-tournament-option">
                                <div class="option-icon"><i class="ph ph-trophy"></i></div>
                                <h3>Create Tournament</h3>
                                <p>Combine multiple quizzes into one match</p>
                                <button class="btn btn-primary">Create Tournament</button>
                            </div>
                            
                            <div class="option-card" id="browse-quizzes-option">
                                <div class="option-icon"><i class="ph ph-books"></i></div>
                                <h3>Browse Quizzes</h3>
                                <p>Play existing quizzes and view highscores</p>
                                <button class="btn btn-outline">Browse Quizzes</button>
                            </div>
                            
                            <div class="option-card" id="join-quiz-option">
                                <div class="option-icon"><i class="ph ph-game-controller"></i></div>
                                <h3>Join Quiz Session</h3>
                                <p>Enter a room code to join an existing quiz</p>
                                <button class="btn btn-outline">Join Session</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Create Quiz Screen -->
            <div id="create-quiz-screen" class="game-screen hidden">
                <div class="card">
                    <div class="card-header">
                        <h2>Create Your Quiz</h2>
                        <p>AI will generate questions based on your topic</p>
                    </div>
                    <div class="card-body">
                        <form id="create-quiz-form">
                            <div class="form-group">
                                <label for="quiz-title">Quiz Title</label>
                                <input type="text" id="quiz-title" placeholder="e.g., Video Games from 2010" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="quiz-topic">Topic Description</label>
                                <textarea id="quiz-topic" placeholder="Describe what the quiz should be about..." required rows="3"></textarea>
                                <small>Be specific! Example: "Popular video games released in 2010, including indie and AAA titles"</small>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="question-count">Number of Questions</label>
                                    <select id="question-count">
                                        <option value="5">5 Questions</option>
                                        <option value="10" selected>10 Questions</option>
                                        <option value="15">15 Questions</option>
                                        <option value="20">20 Questions</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label for="creator-name">Your Name</label>
                                    <input type="text" id="creator-name" placeholder="Quiz Creator" required>
                                </div>
                            </div>
                            
                            <div class="form-actions">
                                <button type="button" id="back-to-welcome" class="btn btn-text">← Back</button>
                                <button type="submit" id="generate-quiz-btn" class="btn btn-orange">
                                    <span class="btn-text">Generate Quiz with AI</span>
                                    <span class="btn-loading hidden"><i class="ph ph-robot"></i> Generating...</span>
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Join Session Screen -->
            <div id="join-session-screen" class="game-screen hidden">
                <div class="card">
                    <div class="card-header">
                        <h2>Join Quiz Session</h2>
                        <p>Enter the room code to join an existing quiz</p>
                    </div>
                    <div class="card-body">
                        <form id="join-session-form">
                            <div class="form-group">
                                <label for="room-code">Room Code</label>
                                <input type="text" id="room-code" placeholder="Enter 6-digit room code" required maxlength="6">
                            </div>
                            
                            <div class="form-group">
                                <label for="player-name">Your Name</label>
                                <input type="text" id="player-name" placeholder="Enter your name" required>
                            </div>
                            
                            <div class="form-actions">
                                <button type="button" id="back-to-welcome-2" class="btn btn-text">← Back</button>
                                <button type="submit" class="btn btn-primary">Join Session</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Create Tournament Screen -->
            <div id="create-tournament-screen" class="game-screen hidden">
                <div class="card">
                    <div class="card-header">
                        <h2><i class="ph ph-trophy"></i> Create Tournament</h2>
                        <p>Combine multiple quizzes into one competitive match</p>
                    </div>
                    <div class="card-body">
                        <div class="tournament-creator">
                            <div class="tournament-layout">
                                <div class="quiz-selection-panel">
                                    <h3>Available Quizzes</h3>
                                    <div class="quiz-search-bar">
                                        <input type="text" id="tournament-quiz-search" placeholder="Search quizzes...">
                                        <button id="tournament-search-btn" class="btn btn-outline"><i class="ph ph-magnifying-glass"></i></button>
                                    </div>
                                    <div id="available-quizzes" class="available-quiz-list">
                                        <div class="loading-quizzes">
                                            <div class="loading-spinner"></div>
                                            <p>Loading quizzes...</p>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="tournament-config-panel">
                                    <div class="selected-quizzes-section">
                                        <h3>Selected Quizzes (<span id="selected-quiz-count">0</span>)</h3>
                                        <div id="selected-quizzes" class="selected-quiz-list">
                                            <div class="empty-selection">
                                                <i class="ph ph-selection-plus"></i>
                                                <p>Select quizzes from the left to add them to your tournament</p>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="tournament-info">
                                        <h3>Tournament Details</h3>
                                        <div class="tournament-stats">
                                            <div class="stat-item">
                                                <span class="stat-label">Total Questions:</span>
                                                <span id="total-tournament-questions">0</span>
                                            </div>
                                            <div class="stat-item">
                                                <span class="stat-label">Maximum Score:</span>
                                                <span id="max-tournament-score">0</span>
                                            </div>
                                        </div>
                                        
                                        <form id="tournament-form">
                                            <div class="form-group">
                                                <label for="tournament-name">Tournament Name</label>
                                                <input type="text" id="tournament-name" placeholder="e.g., Ultimate Knowledge Challenge" required>
                                            </div>
                                            
                                            <div class="form-group">
                                                <label for="tournament-creator">Your Name</label>
                                                <input type="text" id="tournament-creator" placeholder="Tournament Host" required>
                                            </div>
                                            
                                            <div class="tournament-actions">
                                                <button type="button" id="back-to-welcome-tournament" class="btn btn-text">← Back</button>
                                                <button type="submit" id="create-tournament-btn" class="btn btn-primary" disabled>
                                                    <i class="ph ph-trophy"></i> Create Tournament
                                                </button>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Browse Quizzes Screen -->
            <div id="browse-quizzes-screen" class="game-screen hidden">
                <div class="card">
                    <div class="card-header">
                        <h2>Browse Quizzes</h2>
                        <p>Discover and play quizzes created by the community</p>
                    </div>
                    <div class="card-body">
                        <div class="quiz-browser">
                            <div class="browser-controls">
                                <div class="search-bar">
                                    <input type="text" id="quiz-search" placeholder="Search quizzes by topic...">
                                    <button id="search-btn" class="btn btn-outline"><i class="ph ph-magnifying-glass"></i></button>
                                </div>
                                <div class="filter-tabs">
                                    <button class="tab-btn active" data-filter="recent">Recent</button>
                                    <button class="tab-btn" data-filter="popular">Popular</button>
                                    <button class="tab-btn" data-filter="all">All Quizzes</button>
                                </div>
                            </div>
                            
                            <div id="quiz-list" class="quiz-list">
                                <div class="loading-quizzes">
                                    <div class="loading-spinner"></div>
                                    <p>Loading quizzes...</p>
                                </div>
                            </div>
                            
                            <div class="browser-actions">
                                <button type="button" id="back-to-welcome-3" class="btn btn-text">← Back</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quiz Lobby Screen -->
            <div id="lobby-screen" class="game-screen hidden">
                <div class="card">
                    <div class="card-header">
                        <h2 id="quiz-title-display">Quiz Lobby</h2>
                        <div class="room-info">
                            <span class="room-label">Room Code:</span>
                            <span id="room-code-display" class="room-code">000000</span>
                            <button id="copy-room-code" class="btn btn-icon" title="Copy room code"><i class="ph ph-clipboard"></i></button>
                        </div>
                    </div>
                    
                    <div class="card-body">
                        <div class="lobby-layout">
                            <div class="quiz-info">
                                <h3>Quiz Information</h3>
                                <div class="quiz-details">
                                    <div class="detail-item">
                                        <span class="label">Topic:</span>
                                        <span id="quiz-topic-display">-</span>
                                    </div>
                                    <div class="detail-item">
                                        <span class="label">Questions:</span>
                                        <span id="quiz-question-count">-</span>
                                    </div>
                                    <div class="detail-item">
                                        <span class="label">Created by:</span>
                                        <span id="quiz-creator">-</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="players-section">
                                <h3>Players (<span id="player-count">0</span>)</h3>
                                <ul id="player-list" class="player-list"></ul>
                                
                                <div class="ready-system">
                                    <button id="ready-btn" class="btn btn-outline-success">Ready to Play</button>
                                    <div id="host-controls" class="host-controls hidden">
                                        <button id="start-quiz-btn" class="btn btn-primary" disabled>Start Quiz</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quiz Game Screen -->
            <div id="quiz-screen" class="game-screen hidden">
                <div class="quiz-container">
                    <div class="quiz-header">
                        <div class="question-progress">
                            <span>Question <span id="current-question-num">1</span> of <span id="total-questions">10</span></span>
                        </div>
                        <div class="scoring-info">
                            <span>100 points per correct answer</span>
                        </div>
                    </div>
                    
                    <div class="question-card">
                        <h2 id="question-text">Loading question...</h2>
                        
                        <div id="answer-options" class="answer-options">
                            <!-- Answer options will be populated dynamically -->
                        </div>
                        
                        <div id="question-status" class="question-status">
                            <span id="players-answered">0</span> of <span id="total-players-quiz">1</span> players answered
                        </div>
                        
                        <!-- Inline Results Section -->
                        <div id="inline-results" class="inline-results hidden">
                            <div class="result-explanation">
                                <div id="inline-explanation" class="explanation-text"></div>
                            </div>
                            
                            <div class="score-display">
                                <div id="points-earned" class="points-earned"></div>
                                <div id="current-score" class="current-score"></div>
                            </div>
                            
                            <div class="next-question-controls">
                                <button id="continue-btn" class="btn btn-primary hidden">Next Question</button>
                                <button id="finish-quiz-btn" class="btn btn-success hidden">View Final Results</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Question Results Screen -->
            <div id="results-screen" class="game-screen hidden">
                <div class="card">
                    <div class="card-header">
                        <h2>Question Results</h2>
                    </div>
                    
                    <div class="card-body">
                        <div class="correct-answer">
                            <h3>Correct Answer:</h3>
                            <div id="correct-answer-display" class="answer-highlight"></div>
                            <div id="answer-explanation" class="explanation"></div>
                        </div>
                        
                        <div class="player-results">
                            <h3>Player Scores</h3>
                            <div id="player-scores" class="score-list"></div>
                        </div>
                        
                        <div class="results-actions">
                            <button id="next-question-btn" class="btn btn-primary hidden">Next Question</button>
                            <button id="view-final-results-btn" class="btn btn-success hidden">View Final Results</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Final Results Screen -->
            <div id="final-results-screen" class="game-screen hidden">
                <div class="card">
                    <div class="card-header">
                        <h2><i class="ph ph-trophy"></i> Quiz Complete!</h2>
                    </div>
                    
                    <div class="card-body">
                        <div class="final-scores">
                            <h3>Final Leaderboard</h3>
                            <div id="final-leaderboard" class="leaderboard"></div>
                        </div>
                        
                        <div class="final-actions">
                            <button id="play-again-btn" class="btn btn-primary">Play Again</button>
                            <button id="new-quiz-btn" class="btn btn-outline">Create New Quiz</button>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay hidden">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <h3 id="loading-message">Generating your quiz...</h3>
            <p id="loading-submessage">This may take a few moments</p>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div id="toast-container" class="toast-container"></div>

    <!-- Custom Modal System -->
    <div id="alert-modal" class="modal-overlay alert-modal hidden">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-icon alert"><i class="ph ph-warning"></i></div>
                <h3 class="modal-title">Alert</h3>
            </div>
            <div class="modal-body">
                <p id="alert-message" class="modal-message"></p>
            </div>
            <div class="modal-actions">
                <button id="alert-ok-btn" class="btn btn-primary">OK</button>
            </div>
        </div>
    </div>

    <div id="confirm-modal" class="modal-overlay confirm-modal hidden">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-icon confirm"><i class="ph ph-question"></i></div>
                <h3 class="modal-title">Confirm</h3>
            </div>
            <div class="modal-body">
                <p id="confirm-message" class="modal-message"></p>
            </div>
            <div class="modal-actions">
                <button id="confirm-cancel-btn" class="btn btn-cancel">Cancel</button>
                <button id="confirm-ok-btn" class="btn btn-confirm">Confirm</button>
            </div>
        </div>
    </div>

    <div id="prompt-modal" class="modal-overlay prompt-modal hidden">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-icon prompt"><i class="ph ph-pencil"></i></div>
                <h3 class="modal-title">Input Required</h3>
            </div>
            <div class="modal-body">
                <p id="prompt-message" class="modal-message"></p>
                <input type="text" id="prompt-input" class="modal-input" placeholder="Enter value...">
            </div>
            <div class="modal-actions">
                <button id="prompt-cancel-btn" class="btn btn-cancel">Cancel</button>
                <button id="prompt-ok-btn" class="btn btn-confirm">OK</button>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getDatabase } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';
        import { getAnalytics } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-analytics.js';
        
        const firebaseConfig = {
            apiKey: "AIzaSyDrIwGLHc4T5XlH3QBID18Lc48xF9dmDi4",
            authDomain: "quizgame-9916c.firebaseapp.com",
            databaseURL: "https://quizgame-9916c-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "quizgame-9916c",
            storageBucket: "quizgame-9916c.firebasestorage.app",
            messagingSenderId: "918293512223",
            appId: "1:918293512223:web:bd261da506d1c1a270952a",
            measurementId: "G-E4883TXD7S"
        };
        
        try {
            const app = initializeApp(firebaseConfig);
            const database = getDatabase(app);
            const analytics = getAnalytics(app);
            
            window.firebaseApp = app;
            window.firebaseDatabase = database;
            window.firebaseReady = true;
            
            console.log('✅ Firebase initialized successfully');
        } catch (error) {
            console.error('❌ Firebase initialization error:', error);
            window.firebaseReady = false;
        }
    </script>

    <!-- Include the game logic -->
    <script type="module" src="js/quiz-game.js"></script>
</body>
</html>