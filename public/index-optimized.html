<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quizaru - Interactive Quiz Game</title>
    <meta name="description" content="Create and play interactive quizzes with AI-generated questions">
    
    <!-- Preload critical resources -->
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;900&display=swap" as="style">
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;500;700&display=swap" as="style">
    <link rel="preload" href="js/quiz-game-optimized.js" as="script">
    
    <!-- Critical CSS inlined for immediate rendering -->
    <style>
        /* Critical CSS - Above the fold styles only */
        :root {
          --digital-void-bg: #DEE4EC;
          --kb-black: #131417;
          --kb-grey: #7E8187;
          --kb-light-grey: #A8ADB4;
          --teen-orange: #FF4600;
          --electric-cyan: #00F9FF;
          --neon-lime: #D2FF00;
          --font-primary: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
          --font-display: 'Roboto Mono', monospace;
        }

        * {
          margin: 0;
          padding: 0;
          box-sizing: border-box;
        }

        body {
          font-family: var(--font-primary);
          font-size: 16px;
          line-height: 1.6;
          color: var(--kb-black);
          background-color: var(--digital-void-bg);
          -webkit-font-smoothing: antialiased;
        }

        .app-container {
          min-height: 100vh;
          display: flex;
          flex-direction: column;
          max-width: 1200px;
          margin: 0 auto;
          padding: 24px;
        }

        .game-container {
          flex: 1;
          display: flex;
          flex-direction: column;
          justify-content: center;
          align-items: center;
          width: 100%;
        }

        .card {
          background-color: rgba(255, 255, 255, 0.9);
          border: 3px solid var(--kb-black);
          box-shadow: 8px 8px 0 rgba(19, 20, 23, 0.1);
          width: 100%;
          max-width: 800px;
          margin: 0 auto;
        }

        .card-header {
          padding: 24px 32px;
          border-bottom: 2px solid var(--kb-black);
        }

        .card-body {
          padding: 24px 32px;
        }

        h1, h2 {
          font-family: var(--font-display);
          font-weight: 900;
          text-transform: uppercase;
          letter-spacing: 0.05em;
          margin-bottom: 16px;
        }

        h1 { font-size: 2.5rem; }
        h2 { font-size: 2rem; }

        .welcome-options {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
          gap: 24px;
          margin-top: 24px;
        }

        .option-card {
          background: rgba(255, 255, 255, 0.8);
          border: 2px solid var(--kb-black);
          padding: 24px;
          text-align: center;
          transition: all 0.25s ease-in-out;
        }

        .option-card:hover {
          transform: translateY(-2px);
          box-shadow: 4px 4px 0 rgba(19, 20, 23, 0.2);
        }

        .option-icon {
          font-size: 3rem;
          margin-bottom: 16px;
          color: var(--teen-orange);
        }

        .btn {
          display: inline-block;
          padding: 12px 24px;
          font-family: var(--font-display);
          font-weight: 700;
          text-transform: uppercase;
          letter-spacing: 0.05em;
          border: 2px solid var(--kb-black);
          background: white;
          color: var(--kb-black);
          cursor: pointer;
          transition: all 0.15s ease-in-out;
          text-decoration: none;
        }

        .btn:hover {
          transform: translateY(-2px);
          box-shadow: 2px 2px 0 var(--kb-black);
        }

        .btn-primary {
          background: var(--teen-orange);
          color: white;
          border-color: var(--teen-orange);
        }

        .btn:disabled,
        .btn:disabled *,
        .btn:disabled .btn-text,
        .btn:disabled span {
          opacity: 1 !important;
          cursor: not-allowed !important;
          transform: none !important;
          color: white !important;
          background: repeating-linear-gradient(
            45deg,
            var(--kb-light-grey),
            var(--kb-light-grey) 10px,
            var(--kb-grey) 10px,
            var(--kb-grey) 20px
          ) !important;
          border-color: var(--kb-grey) !important;
          pointer-events: none !important;
        }

        .btn:disabled:hover,
        .btn:disabled:hover *,
        .btn:disabled:hover .btn-text,
        .btn:disabled:hover span {
          transform: none !important;
          box-shadow: none !important;
          color: white !important;
          background: repeating-linear-gradient(
            45deg,
            var(--kb-light-grey),
            var(--kb-light-grey) 10px,
            var(--kb-grey) 10px,
            var(--kb-grey) 20px
          ) !important;
          border-color: var(--kb-grey) !important;
          cursor: not-allowed !important;
          pointer-events: none !important;
        }

        .hidden {
          display: none !important;
        }

        .game-screen {
          display: none;
          width: 100%;
        }

        .game-screen.active {
          display: block;
          animation: fadeIn 0.3s ease-in-out;
        }

        @keyframes fadeIn {
          from { opacity: 0; transform: translateY(10px); }
          to { opacity: 1; transform: translateY(0); }
        }

        .loading-overlay {
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background: rgba(0, 0, 0, 0.8);
          display: flex;
          align-items: center;
          justify-content: center;
          z-index: 9999;
        }

        .loading-spinner {
          width: 40px;
          height: 40px;
          border: 4px solid rgba(255, 255, 255, 0.3);
          border-top: 4px solid white;
          border-radius: 50%;
          animation: spin 1s linear infinite;
        }

        @keyframes spin {
          0% { transform: rotate(0deg); }
          100% { transform: rotate(360deg); }
        }

        /* Form styling fixes */
        input[type="text"], input[type="number"], textarea, select {
          color: var(--kb-black) !important;
          background-color: rgba(255, 255, 255, 0.9) !important;
          -webkit-appearance: none;
          -moz-appearance: none;
          appearance: none;
          border: 2px solid var(--kb-black);
          padding: 12px;
          font-family: var(--font-primary);
        }

        input[type="text"]:focus, input[type="number"]:focus, textarea:focus, select:focus {
          color: var(--kb-black) !important;
          background-color: rgba(255, 255, 255, 1) !important;
        }

        select {
          background-image: none !important;
          cursor: pointer;
        }

        /* Ultra-specific disabled button text override */
        #generate-quiz-btn[disabled] .btn-text,
        #generate-quiz-btn[disabled] span,
        .btn-primary[disabled] .btn-text,
        .btn-primary[disabled] span,
        .btn[disabled] .btn-text,
        .btn[disabled] span,
        #generate-quiz-btn:disabled .btn-text,
        #generate-quiz-btn:disabled span,
        .btn-primary:disabled .btn-text,
        .btn-primary:disabled span,
        .btn:disabled .btn-text,
        .btn:disabled span {
          color: white !important;
        }

        @media (max-width: 768px) {
          .app-container { padding: 16px; }
          .welcome-options { grid-template-columns: 1fr; }
          .card-header, .card-body { padding: 16px; }
          h1 { font-size: 1.8rem; }
          h2 { font-size: 1.5rem; }
        }
    </style>
    
    <!-- Async load non-critical CSS -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;900&display=swap" media="print" onload="this.media='all'">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;500;700&display=swap" media="print" onload="this.media='all'">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@phosphor-icons/web@2.1.1/src/regular/style.css" media="print" onload="this.media='all'">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@phosphor-icons/web@2.1.1/src/fill/style.css" media="print" onload="this.media='all'">
    
    <!-- Load extended styles after critical path -->
    <link rel="preload" href="css/styles.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="css/styles.css"></noscript>
    
    <link rel="icon" type="image/svg+xml" href="img/icons/favicon.svg">
    
    <!-- Performance configuration -->
    <script>
        // Performance monitoring
        window.perfStart = performance.now();
        
        // PartyKit Configuration
        window.PARTYKIT_HOST = 'quiz-world.t3mr0i.partykit.dev';
        
        const urlParams = new URLSearchParams(window.location.search);
        const isLocalhost = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
        
        if (urlParams.has('dev') || urlParams.has('local') || isLocalhost) {
            window.PARTYKIT_HOST = 'localhost:1999';
            console.log('üîß Using local development server:', window.PARTYKIT_HOST);
        }
        
        window.CONFIG = {
            ALLOW_ANYONE_TO_START: urlParams.has('allow-all') || urlParams.has('all-start'),
            PERFORMANCE_MODE: urlParams.has('perf') || urlParams.has('performance')
        };
        
        // Performance debugging
        if (window.CONFIG.PERFORMANCE_MODE) {
            console.log('‚ö° Performance mode enabled');
            
            // Log timing milestones
            window.addEventListener('load', () => {
                console.log(`üèÅ Page loaded in ${(performance.now() - window.perfStart).toFixed(2)}ms`);
            });
            
            // Monitor First Contentful Paint
            new PerformanceObserver((list) => {
                for (const entry of list.getEntries()) {
                    if (entry.name === 'first-contentful-paint') {
                        console.log(`üé® First Contentful Paint: ${entry.startTime.toFixed(2)}ms`);
                    }
                }
            }).observe({ entryTypes: ['paint'] });
        }
    </script>
</head>
<body>
    <div class="app-container">
        <main class="game-container">
            <!-- Welcome Screen -->
            <div id="welcome-screen" class="game-screen active">
                <div class="card welcome-card">
                    <div class="card-header">
                        <h1><i class="ph ph-brain"></i> Quizaru</h1>
                        <p>Create and play interactive quizzes with AI</p>
                    </div>
                    <div class="card-body">
                        <div class="welcome-options">
                            <div class="option-card" id="create-quiz-option">
                                <div class="option-icon"><i class="ph ph-target"></i></div>
                                <h3>Create New Quiz</h3>
                                <p>Generate a quiz with AI on any topic</p>
                                <button class="btn btn-primary">Create Quiz</button>
                            </div>
                            
                            <div class="option-card" id="create-tournament-option">
                                <div class="option-icon"><i class="ph ph-trophy"></i></div>
                                <h3>Create Tournament</h3>
                                <p>Combine multiple quizzes into one match</p>
                                <button class="btn btn-primary">Create Tournament</button>
                            </div>
                            
                            <div class="option-card" id="browse-quizzes-option">
                                <div class="option-icon"><i class="ph ph-books"></i></div>
                                <h3>Browse Quizzes</h3>
                                <p>Play existing quizzes and view highscores</p>
                                <button class="btn btn-outline">Browse Quizzes</button>
                            </div>
                            
                            <div class="option-card" id="join-quiz-option">
                                <div class="option-icon"><i class="ph ph-game-controller"></i></div>
                                <h3>Join Quiz Session</h3>
                                <p>Enter a room code to join an existing quiz</p>
                                <button class="btn btn-outline">Join Session</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Create Quiz Screen -->
            <div id="create-quiz-screen" class="game-screen hidden">
                <div class="card">
                    <div class="card-header">
                        <h2>Create Your Quiz</h2>
                        <p>AI will generate questions based on your topic</p>
                    </div>
                    <div class="card-body">
                        <form id="create-quiz-form">
                            <div class="form-group">
                                <label for="quiz-title">Quiz Title</label>
                                <input type="text" id="quiz-title" placeholder="e.g., Video Games from 2010" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="quiz-topic">Topic Description</label>
                                <textarea id="quiz-topic" placeholder="Describe what the quiz should be about..." required rows="3"></textarea>
                                <small>Be specific! Example: "Popular video games released in 2010, including indie and AAA titles"</small>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="question-count">Number of Questions</label>
                                    <select id="question-count">
                                        <option value="5">5 Questions</option>
                                        <option value="10" selected>10 Questions</option>
                                        <option value="15">15 Questions</option>
                                        <option value="20">20 Questions</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label for="creator-name">Your Name</label>
                                    <input type="text" id="creator-name" placeholder="Quiz Creator" required>
                                </div>
                            </div>
                            
                            <div class="form-actions">
                                <button type="button" id="back-to-welcome" class="btn btn-text">‚Üê Back</button>
                                <button type="submit" id="generate-quiz-btn" class="btn btn-primary" style="--disabled-text-color: white;">
                                    <span class="btn-text" style="color: inherit;">Generate Quiz with AI</span>
                                    <span class="btn-loading hidden"><i class="ph ph-robot"></i> Generating...</span>
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Join Session Screen -->
            <div id="join-session-screen" class="game-screen hidden">
                <div class="card">
                    <div class="card-header">
                        <h2>Join Quiz Session</h2>
                        <p>Enter the room code to join an existing quiz</p>
                    </div>
                    <div class="card-body">
                        <form id="join-session-form">
                            <div class="form-group">
                                <label for="room-code">Room Code</label>
                                <input type="text" id="room-code" placeholder="Enter 6-digit room code" required maxlength="6">
                            </div>
                            
                            <div class="form-group">
                                <label for="player-name">Your Name</label>
                                <input type="text" id="player-name" placeholder="Enter your name" required>
                            </div>
                            
                            <div class="form-actions">
                                <button type="button" id="back-to-welcome-2" class="btn btn-text">‚Üê Back</button>
                                <button type="submit" class="btn btn-primary">Join Session</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Load Firebase config first -->
    <script src="js/firebase-config.js" defer></script>
    
    <!-- Load optimized main application -->
    <script type="module" src="js/quiz-game-optimized.js" defer></script>
    
    <!-- Fallback for older browsers -->
    <script nomodule>
        console.warn('This browser does not support ES modules. Please use a modern browser.');
        alert('Please use a modern browser like Chrome, Firefox, Safari, or Edge for the best experience.');
    </script>
</body>
</html> 